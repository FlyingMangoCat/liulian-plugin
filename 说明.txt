# 榴莲插件 (Liulian-Plugin) 使用说明

## 📖 插件简介

Liulian-Plugin 是一个功能丰富的 Yunzai-Bot 插件，提供原神地下地图、B站推送、插件管理、AI对话、群聊互动等多功能扩展。

**🔗 项目地址**: https://gitee.com/huifeidemangguomao/liulian-plugin.git

## 🚀 快速开始

### 环境要求
- 最新版本的 Yunzai-Bot
- Node.js 环境
- pnpm 包管理器

### 安装步骤
1. 将整个 `liulian-plugin` 文件夹放置在 `Yunzai-Bot/plugins/` 目录下
2. 在插件目录下执行 `pnpm install -P` 安装依赖
3. 重启 Yunzai-Bot 即可使用

### ⚠️ 特别说明
- **TRSS版云崽用户**: 如插件载入时报错，请在 `config\config` 下创建 `qq.yaml`，模板路径 `liulian-plugin/config/qq.yaml`，根据ICQQ-plugin下config.yaml中的配置填写后即可正常使用
- **AI功能**: 榴莲AI已正式上线（目前可在往生堂业务群/榴莲官方群体验）

## 📊 项目概览

| 项目信息 | 详情 |
|---------|------|
| **名称** | 榴莲插件 (liulian-plugin) |
| **类型** | 云崽 (Yunzai-Bot) 插件 |
| **当前版本** | v0.10.1 |
| **描述** | 多功能扩展插件，提供原神地下地图、B站推送、插件管理、AI对话、群聊互动等功能 |

### 🛠️ 技术栈
- **编程语言**: JavaScript (Node.js)
- **模块系统**: ESM (ECMAScript Modules)
- **核心依赖**: 
  - `image-size`, `axios`, `ffmpeg`, `request`
  - `qrcode`, `ioredis`, `pg`, `mongoose`
  - `node-fetch`, `cheerio` 等
- **模块导入**: 使用 `#liulian` 和 `#liulian.models` 别名

## 🎯 核心功能模块

> 插件功能主要分布在 `apps` 目录下，通过 `apps/index.js` 统一导出和规则注册

### 📚 帮助与信息
- `help.js` - 主帮助系统
- `maphelp.js` - 地图相关帮助
- `pluginhelp.js` - 插件管理帮助
- `修仙help.js` - 修仙功能帮助
- `bilibilihelp.js` - B站推送帮助

### 🤖 AI 对话系统
- `ai.js` - 基于Ollama的AI对话
  - ✅ 多模型支持
  - ✅ 用户记忆系统
  - ✅ 情绪系统与好感度联动
  - ✅ 中间件模式

### 🎮 原神/星铁功能
- `XMmap.js` - 地下地图查看（须弥雨林/沙漠）
- `Guess.js` - 猜角色/头像游戏

### 💬 群聊互动

#### 🎉 娱乐功能
- `whoismywife.js` - 娶群友
- `Cat.js` - 猫猫游戏
- `manyfunctions.js` - 多功能娱乐（毒鸡汤、彩虹屁、土味情话、笑话、天气、早报、运势等）
- `Random expression.js` - 随机表情
- `chatterboxStat.js` - 话痨统计
- `other.js` - 趣味功能（二次元的我、我的成分、答案之书、观音灵签）
- `classic.js` - 经典语录

#### ⚙️ 管理功能
- `Groupshutup.js` - 群聊闭嘴/张嘴
- `transmit.js` - 带话/广播
- `伪造信息.js` - 伪造消息
- `打卡.js` - 打卡系统
- `群友强制休息.js` - 休息管理
- `updatecard.js` - 更新群名片

### 📺 B站推送
- `bilibiliPush.js` - B站动态推送系统

### 🔧 插件管理
- `pluginManager.js` - V2插件管理
- `V3pluginManager.js` - V3插件管理

### 🎪 其他功能
- `寄你太美.js` - 图片/动图回复
- `admin.js` - 设置、更新、配置
- `status.js` - 插件状态查看

## ⚙️ 配置与数据

### 📁 配置文件
- `model/config/` - 主要配置目录
- `config/ai.js` - AI模块配置
- `config/default_config/` - 默认配置模板

### 🗄️ 数据存储
- `components/Data.js` - 通用数据处理
- `components/Data2.js` - 扩展数据处理
- **数据库支持**:
  - PostgreSQL (AI模块)
  - MongoDB (AI模块)
  - Redis (`ioredis`) - 插件信息缓存

### 🎨 资源文件
- `resources/` - 静态资源目录
  - `随机表情/` - 表情包资源
  - `须弥-雨林/` - 雨林地图图片
  - `须弥-沙漠/` - 沙漠地图图片
  - `星铁/` - 星铁相关图片
  - `自定义表情/` - 自定义表情包
  - `admin/`, `help/` - 渲染模板资源

## 🏗️ 构建与运行

### 📦 安装步骤
1. **放置插件** - 将整个插件文件夹放置于 Yunzai-Bot 的 `plugins` 目录下
2. **安装依赖** - 在插件目录下执行：
   ```bash
   pnpm install -P
   ```

### 🚀 运行方式

#### 方式一：Yunzai-Bot插件模式
- 作为 Yunzai-Bot 插件，随 Yunzai-Bot 启动而自动加载

#### 方式二：AI中间件模式
- 在插件目录下执行以下命令启动独立的AI服务：
   ```bash
   node liulian.js
   ```

### 🔄 更新方法
1. **代码更新**：
   ```bash
   git pull
   ```
2. **依赖更新**：
   ```bash
   pnpm install -P
   ```
3. **插件内更新**：
   - `#榴莲更新` - 更新代码
   - `#榴莲更新图像` - 更新图像资源

## 📋 开发约定

### 🏗️ 架构设计
- **模块化**: 功能分散在 `apps/` 目录下的独立文件中
- **规则注册**: 所有命令规则在 `apps/index.js` 中的 `rule` 对象中定义
- **ESM**: 项目使用 ES Module (`"type": "module"` in `package.json`)
- **内部导入**: 使用 `#liulian` 和 `#liulian.models` 别名简化路径

---

## 📝 命令列表

> ⚠️ 部分功能可能已经失效，如需修复请通过相关渠道反馈

### 📚 帮助类
- `#榴莲帮助` / `#帮助` / `#help` - 主帮助
- `#地下地图帮助` - 地图功能帮助
- `#插件管理帮助` - 插件管理帮助
- `#修仙使用帮助` - 修仙功能帮助
- `#(B站|b站|小破站)推送帮助` - B站推送帮助

### 🛠️ 管理类
- `#榴莲设置` - 插件设置
- `#榴莲版本` - 查看版本
- `#榴莲更新` / `#榴莲强制更新` - 更新插件
- `#榴莲更新图像` - 更新图像资源

### 🎮 游戏娱乐
- `#(娶群友|拐群友|绑架群友|娶老婆)` - 娶群友游戏
- `#猜(头像|角色)` - 猜角色/头像游戏
- `#猜歌名` - 猜歌名游戏
- `#猫猫突袭` - 猫猫游戏
- `#抱走猫猫` - 抱走猫猫

### 🎯 原神/星铁
- `#原神地下地图编号` - 查看地图编号
- `地下地图` - 地图功能
- `#神之眼` - 神之眼测试
- `#看头像` - 查看头像

### 📊 统计查询
- `#话痨统计` / `#话痨检测` - 话痨统计
- `#二次元的我` - 二次元成分分析
- `#我的成分` - 成分分析
- `#答案之书` - 答案之书
- `#观音灵签` - 观音灵签

### 📱 日常功能
- `打卡` / `赞我` - 打卡功能
- `#毒鸡汤` - 毒鸡汤
- `#彩虹屁` / `#夸夸我` - 彩虹屁
- `#土味情话` - 土味情话
- `#讲个笑话` - 讲笑话
- `#早报` / `#新闻` - 每日早报
- `#星座运势` - 星座运势
- `#天气` - 天气查询
- `#每日句子` - 每日句子
- `#每日单词` - 每日单词

### 📺 B站推送
- `#开启B站推送` / `#关闭B站推送` - 开关推送
- `#订阅B站推送` / `#移除B站推送` - 订阅管理
- `#B站推送列表` - 查看推送列表
- `#测试B站推送` - 测试推送

### 🔧 群管理
- `#群聊闭嘴` / `#群聊张嘴` - 群聊禁言管理
- `#带话` - 带话功能
- `#广播` - 广播功能
- `#伪造信息` - 伪造消息
- `#更新群名片` - 更新群名片
- `#我要休息` - 强制休息

### 🎨 表情图片
- `#发病` - 发病表情
- `#抽色图` / `#抽老婆` - 抽图功能
- `#上传表情包` - 上传表情
- `#看腿1` / `#看腿2` - 看腿功能
- `#涩涩一下` - 涩涩功能

### 🎵 音乐游戏
- `#明日方舟` / `#原神` / `#崩坏3` 等游戏角色
- `#初音未来` / `#miku` - 初音未来
- `(鸡你太美|寄你太美|黑子|油饼)` - 特殊触发词

---

**📢 反馈渠道**: 如发现问题或有建议，请通过相关渠道反馈，我们会及时处理。